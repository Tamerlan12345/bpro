## 2026-02-25 — [Backend/Error Handling]
**Проблема:** Создание чата или департамента с несуществующим ID родителя (Department/User) вызывало ошибку 500 (Foreign Key Violation). Пользователь получал "Internal Server Error" вместо понятного сообщения.
**Решение:** В `POST /api/departments` и `POST /api/chats` добавлен перехват ошибки PostgreSQL `23503` (Foreign Key Violation). Теперь возвращается статус 400 с сообщением "User not found" или "Department not found".
**Безопасность:** Логика не изменена, добавлен только обработчик специфичного кода ошибки. Существующие проверки (например, на дубликаты) сохранены. Покрытие тестами обеспечено.

## 2026-02-27 — [Auth/Logic]
**Проблема:** Роль 'admin' присваивалась жестко в коде только пользователю с именем "admin". Это делало невозможным создание других админов и открывало уязвимость, если у пользователя "admin" в БД роль была изменена на "user" (код игнорировал БД).
**Решение:** В `/api/auth/login` удалена проверка имени. Теперь роль берется напрямую из колонки `role` в базе данных. В `ensureUsersExist` добавлена самовосстанавливающаяся логика: при старте сервера роль пользователя "admin" принудительно устанавливается в 'admin', если она отличается.
**Безопасность:** Усилена. Теперь права доступа полностью управляются базой данных. Исключена ситуация "Hardcoded Backdoor". Добавлен тест `nexus_role_logic.test.js`.
